# This should replace config/letsencrypt/nginx/site-confs/default

server_names_hash_bucket_size  64;

# Redirect all traffic to https
server {
	listen 80;
	listen [::]:80;
	return 301 https://$host$request_uri;
}

# Main server block
server {
        server_name extreme-weather.gq
	listen 443 ssl http2;
	listen [::]:443 ssl http2;

	# enable subfolder method reverse proxy confs
	include /config/nginx/proxy-confs/*.subfolder.conf;

	# all ssl related config moved to ssl.conf
	include /config/nginx/ssl.conf;

	client_max_body_size 0;

	location / {
		proxy_pass http://frontend:5005/;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}


# Main server block
#server {
#        server_name notes365.gq;
#        listen 443 ssl http2 default_server;
#        listen [::]:443 ssl http2 default_server;

#        root /config/www;
#        index index.html index.htm index.php;

        # enable subfolder method reverse proxy confs
#        include /config/nginx/proxy-confs/*.subfolder.conf;

        # all ssl related config moved to ssl.conf
#        include /config/nginx/ssl.conf;

#        client_max_body_size 0;

#        location / {
#                proxy_pass http://notes-frontend:5000/;
#                proxy_set_header X-Real-IP $remote_addr;
#                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#        }

#        location /notes/ {
#        proxy_pass http://notes-backend:6200;
#                proxy_redirect off;
#                proxy_http_version 1.1;
#                proxy_buffering off;
#        }

#        location /user/ {
#        proxy_pass http://notes-backend:6200;
#                proxy_redirect off;
#                proxy_http_version 1.1;
#                proxy_buffering off;
#        }

#        location /admin/ {
#        proxy_pass http://notes-backend:6200;
#                proxy_redirect off;
#                proxy_http_version 1.1;
#                proxy_buffering off;
#    }
#}


# Enable subdomain method reverse proxy confs
include /config/nginx/proxy-confs/*.subdomain.conf;
# Enable proxy cache for auth
proxy_cache_path cache/ keys_zone=auth_cache:10m;
